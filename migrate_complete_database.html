<!DOCTYPE html>
<html>
<head>
    <title>Complete Database Migration to Firebase</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 1200px; margin: 0 auto; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .info { color: blue; }
        button { padding: 15px 30px; font-size: 18px; margin: 10px 0; background: #4CAF50; color: white; border: none; cursor: pointer; border-radius: 5px; }
        button:hover { background: #45a049; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        #results { margin-top: 20px; padding: 20px; background: #f5f5f5; border-radius: 5px; }
        .count { font-weight: bold; color: #2196F3; }
        ul { list-style-type: none; padding-left: 0; }
        li { padding: 5px 0; border-bottom: 1px solid #ddd; }
    </style>
</head>
<body>
    <h1>ğŸ”¥ Complete Database Migration to Firebase</h1>
    <p><strong>This will migrate ALL data from MySQL to Firebase Realtime Database</strong></p>
    <p class="info">ğŸ“Š Migrating: roulette_state, detailed_draw_results, roulette_analytics, betting_slips, bets</p>
    <p class="info">ğŸ”— Firebase URL: <a href="https://console.firebase.google.com/project/roulette-2f902/database" target="_blank">View Realtime Database</a></p>
    
    <button id="migrateBtn" onclick="runCompleteMigration()">ğŸš€ Start Complete Migration</button>
    <div id="results"></div>

    <script>
        async function runCompleteMigration() {
            const btn = document.getElementById('migrateBtn');
            const resultsDiv = document.getElementById('results');
            
            btn.disabled = true;
            btn.textContent = 'â³ Migrating... Please wait...';
            resultsDiv.innerHTML = '<p class="info">ğŸ”„ Starting complete migration... This may take several minutes.</p>';
            
            try {
                const response = await fetch('php/complete_firebase_migration.php');
                
                const responseText = await response.text();
                let data;
                
                try {
                    data = JSON.parse(responseText);
                } catch (e) {
                    throw new Error('Invalid JSON response: ' + responseText.substring(0, 500));
                }
                
                let html = '<h2>ğŸ“Š Migration Results</h2>';
                
                if (data.status === 'success') {
                    html += '<p class="success">âœ… Migration completed successfully!</p>';
                    
                    if (data.counts) {
                        html += '<h3>ğŸ“ˆ Migration Statistics:</h3><ul>';
                        for (const [key, value] of Object.entries(data.counts)) {
                            html += `<li><span class="count">${key}:</span> ${value}</li>`;
                        }
                        html += '</ul>';
                    }
                    
                    html += '<h3>âœ… Migrated Items:</h3><ul>';
                    data.migrations.forEach(item => {
                        html += `<li class="success">âœ… ${item}</li>`;
                    });
                    html += '</ul>';
                    
                    if (data.errors && data.errors.length > 0) {
                        html += '<h3>âš ï¸ Errors:</h3><ul>';
                        data.errors.forEach(error => {
                            html += `<li class="error">âŒ ${error}</li>`;
                        });
                        html += '</ul>';
                    }
                    
                    html += '<p class="success"><strong>ğŸ‰ All data has been migrated to Firebase!</strong></p>';
                    html += '<p class="info">ğŸ“± Your app at <a href="http://localhost/slipp/index.php">index.php</a> will now use Firebase instead of MySQL.</p>';
                } else {
                    html += '<p class="error">âŒ Migration failed</p>';
                    if (data.errors) {
                        html += '<h3>Errors:</h3><ul>';
                        data.errors.forEach(error => {
                            html += `<li class="error">âŒ ${error}</li>`;
                        });
                        html += '</ul>';
                    }
                }
                
                resultsDiv.innerHTML = html;
            } catch (error) {
                resultsDiv.innerHTML = `<p class="error">âŒ Error: ${error.message}</p>`;
            } finally {
                btn.disabled = false;
                btn.textContent = 'ğŸš€ Start Complete Migration';
            }
        }
    </script>
</body>
</html>

