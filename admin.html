<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#4e73df">
    <title>Admin Dashboard - Roulette POS</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="admin/css/admin.css">
    <style>
        /* Ensure sidebar and main content are visible even before JavaScript loads */
        .main-content {
            margin-left: 250px;
            width: calc(100% - 250px);
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Mobile Menu Toggle Button (outside sidebar) -->
    <button id="mobile-menu-toggle" class="sidebar-toggle">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i class="fas fa-dice"></i>
                <span>Roulette Admin</span>
            </div>
            <button id="sidebar-toggle" class="sidebar-toggle">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>

        <div class="sidebar-user">
            <div class="user-avatar">
                <i class="fas fa-user-shield"></i>
            </div>
            <div class="user-info">
                <div class="user-name" id="sidebar-username">Admin</div>
                <div class="user-role">Administrator</div>
            </div>
        </div>

        <ul class="sidebar-menu">
            <li class="menu-header">Main</li>
            <li class="active">
                <a href="admin.html">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
            </li>

            <li class="menu-header">User Management</li>
            <li>
                <a href="admin/users.html">
                    <i class="fas fa-users"></i>
                    <span>Users</span>
                </a>
            </li>
            <li>
                <a href="admin/betting_shops.html">
                    <i class="fas fa-store"></i>
                    <span>Betting Shops</span>
                </a>
            </li>

            <li class="menu-header">Departments</li>
            <li>
                <a href="admin/departments_setup.html">
                    <i class="fas fa-database"></i>
                    <span>Setup Departments</span>
                </a>
            </li>
            <li>
                <a href="admin/stock_accounting_setup.html">
                    <i class="fas fa-database"></i>
                    <span>Setup Stock & Accounting</span>
                </a>
            </li>
            <li>
                <a href="admin/hr_setup.html">
                    <i class="fas fa-database"></i>
                    <span>Setup HR Department</span>
                </a>
            </li>
            <li>
                <a href="admin/remote_setup.html">
                    <i class="fas fa-database"></i>
                    <span>Setup Remote Monitoring</span>
                </a>
            </li>
            <li>
                <a href="sales/index.html" target="_blank">
                    <i class="fas fa-chart-line"></i>
                    <span>Sales Department</span>
                </a>
            </li>
            <li>
                <a href="it/index.html" target="_blank">
                    <i class="fas fa-laptop"></i>
                    <span>IT Department</span>
                </a>
            </li>
            <li>
                <a href="finance/index.html" target="_blank">
                    <i class="fas fa-dollar-sign"></i>
                    <span>Finance Department</span>
                </a>
            </li>
            <li>
                <a href="stock/index.html" target="_blank">
                    <i class="fas fa-boxes"></i>
                    <span>Stock Department</span>
                </a>
            </li>
            <li>
                <a href="accounting/index.html" target="_blank">
                    <i class="fas fa-calculator"></i>
                    <span>Accounting Department</span>
                </a>
            </li>
            <li>
                <a href="hr/index.html" target="_blank">
                    <i class="fas fa-users"></i>
                    <span>HR Department</span>
                </a>
            </li>

            <li class="menu-header">Remote Monitoring</li>
            <li>
                <a href="remote/bet_distribution.html" target="_blank">
                    <i class="fas fa-desktop"></i>
                    <span>Remote Bet Distribution</span>
                </a>
            </li>
            <li>
                <a href="admin/remote_dashboard.html">
                    <i class="fas fa-chart-line"></i>
                    <span>Remote Employee Dashboard</span>
                </a>
            </li>

            <li class="menu-header">Finance</li>
            <li>
                <a href="admin/cash.html">
                    <i class="fas fa-money-bill-wave"></i>
                    <span>Cash Management</span>
                </a>
            </li>
            <li>
                <a href="admin/vouchers.html">
                    <i class="fas fa-ticket-alt"></i>
                    <span>Vouchers</span>
                </a>
            </li>
            <li>
                <a href="commission.html">
                    <i class="fas fa-percentage"></i>
                    <span>Commission</span>
                </a>
            </li>
            <li>
                <a href="admin/transactions.html">
                    <i class="fas fa-exchange-alt"></i>
                    <span>Transactions</span>
                </a>
            </li>

            <li class="menu-header">Game Management</li>
            <li>
                <a href="admin/game_settings.html">
                    <i class="fas fa-cogs"></i>
                    <span>Game Settings</span>
                </a>
            </li>
            <li>
                <a href="admin/betting_history.html">
                    <i class="fas fa-history"></i>
                    <span>Betting History</span>
                </a>
            </li>
            <li>
                <a href="admin/bet_distribution.html">
                    <i class="fas fa-chart-bar"></i>
                    <span>Bet Distribution & Draw Control</span>
                </a>
            </li>

            <li class="menu-header">System</li>
            <li>
                <a href="admin/settings.html">
                    <i class="fas fa-sliders-h"></i>
                    <span>Settings</span>
                </a>
            </li>
            <li>
                <a href="admin/logs.html">
                    <i class="fas fa-clipboard-list"></i>
                    <span>Logs</span>
                </a>
            </li>
            <li>
                <a href="admin/system_logs.html">
                    <i class="fas fa-shield-alt"></i>
                    <span>System Audit Logs</span>
                </a>
            </li>
            <li>
                <a href="admin/db_setup.html">
                    <i class="fas fa-database"></i>
                    <span>Database Setup</span>
                </a>
            </li>
        </ul>

        <div class="sidebar-footer">
            <a href="index.html" class="footer-link" title="Go to Game">
                <i class="fas fa-gamepad"></i>
            </a>
            <a href="admin/settings.html" class="footer-link" title="Settings">
                <i class="fas fa-cog"></i>
            </a>
            <a href="#" id="sidebar-logout-link" class="footer-link" title="Logout">
                <i class="fas fa-sign-out-alt"></i>
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Navbar -->
        <nav class="top-navbar">
            <div class="navbar-search">
                <input type="text" class="search-input" placeholder="Search...">
            </div>

            <ul class="navbar-nav">
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <i class="fas fa-bell"></i>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <i class="fas fa-envelope"></i>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" id="logout-link" class="nav-link">
                        <i class="fas fa-sign-out-alt"></i>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Content Wrapper -->
        <div class="content-wrapper">
            <!-- Page Header -->
            <div class="page-header">
                <h1 class="page-title">Dashboard</h1>
                <div class="breadcrumb">
                    <div class="breadcrumb-item"><a href="admin.html">Admin</a></div>
                    <div class="breadcrumb-item active">Dashboard</div>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="row">
                <div class="col-xl-3 col-md-6">
                    <div class="card border-left-primary shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                        Total Users</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="total-users">0</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-users fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6">
                    <div class="card border-left-success shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                        Total Cash Balance</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="total-cash">$0.00</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6">
                    <div class="card border-left-info shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                        Total Bets</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="total-bets">$0.00</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-dice fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6">
                    <div class="card border-left-warning shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                        Total Commission</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="total-commission">$0.00</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-percentage fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content Row -->
            <div class="row">
                <!-- Area Chart -->
                <div class="col-xl-8 col-lg-7">
                    <div class="card shadow mb-4">
                        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                            <h6 class="m-0 font-weight-bold text-primary">Earnings Overview</h6>
                        </div>
                        <div class="card-body">
                            <div class="chart-area">
                                <canvas id="earningsChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pie Chart -->
                <div class="col-xl-4 col-lg-5">
                    <div class="card shadow mb-4">
                        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                            <h6 class="m-0 font-weight-bold text-primary">Transaction Types</h6>
                        </div>
                        <div class="card-body">
                            <div class="chart-pie">
                                <canvas id="transactionTypesChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content Row -->
            <div class="row">
                <!-- Recent Transactions -->
                <div class="col-lg-6 mb-4">
                    <div class="card shadow mb-4">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">Recent Transactions</h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered" width="100%" cellspacing="0">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>User</th>
                                            <th>Amount</th>
                                            <th>Type</th>
                                            <th>Date</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recent-transactions-tbody">
                                        <tr><td colspan="5" class="text-center">Loading...</td></tr>
                                    </tbody>
                                </table>
                            </div>
                            <a href="#" class="btn btn-primary btn-sm" id="view-all-transactions">View All Transactions</a>
                        </div>
                    </div>
                </div>

                <!-- Recent Users -->
                <div class="col-lg-6 mb-4">
                    <div class="card shadow mb-4">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">Recent Users</h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered" width="100%" cellspacing="0">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Username</th>
                                            <th>Role</th>
                                            <th>Balance</th>
                                            <th>Created</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recent-users-tbody">
                                        <tr><td colspan="5" class="text-center">Loading...</td></tr>
                                    </tbody>
                                </table>
                            </div>
                            <a href="#" class="btn btn-primary btn-sm" id="view-all-users">View All Users</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    
    <!-- Firebase Configuration and Services -->
    <script src="js/firebase-config.js"></script>
    <script src="js/firebase-service.js"></script>
    <script src="js/firebase-auth.js"></script>
    <script src="js/firebase-transactions.js"></script>
    <script src="js/firebase-vouchers.js"></script>
    <script src="js/firebase-commission.js"></script>
    
    <!-- Admin Dashboard JavaScript -->
    <script src="js/admin_firebase.js"></script>
    
    <!-- Sidebar Scripts -->
    <script>
        // Update username when Firebase Auth is ready
        function updateSidebarUsername() {
            if (window.FirebaseAuth && window.FirebaseAuth.isInitialized && window.FirebaseAuth.isInitialized()) {
                const currentUser = window.FirebaseAuth.getCurrentUser();
                if (currentUser && currentUser.username) {
                    const usernameElement = document.getElementById('sidebar-username');
                    if (usernameElement) {
                        usernameElement.textContent = currentUser.username;
                    }
                }
            } else {
                // Retry after a delay
                setTimeout(updateSidebarUsername, 500);
            }
        }

        // Mobile menu toggle
        document.addEventListener('DOMContentLoaded', function() {
            const mobileToggle = document.getElementById('mobile-menu-toggle');
            const sidebarToggle = document.getElementById('sidebar-toggle');
            const sidebar = document.querySelector('.sidebar');

            if (mobileToggle && sidebar) {
                mobileToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('active');
                });
            }

            // Sidebar toggle (for tablet view)
            if (sidebarToggle && sidebar) {
                sidebarToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('active');
                });
            }

            // Close sidebar when clicking outside on mobile
            document.addEventListener('click', function(event) {
                if (!sidebar || !mobileToggle) return;

                // If sidebar is active on mobile and click is outside sidebar and not on the toggle button
                if (window.innerWidth <= 768 &&
                    sidebar.classList.contains('active') &&
                    !sidebar.contains(event.target) &&
                    event.target !== mobileToggle &&
                    !mobileToggle.contains(event.target)) {
                    sidebar.classList.remove('active');
                }
            });

            // Handle responsive behavior based on screen size
            function handleResponsiveLayout() {
                if (!sidebar) return;

                if (window.innerWidth <= 768) {
                    // Mobile view
                    sidebar.classList.remove('active');
                } else if (window.innerWidth <= 1024) {
                    // Tablet view - collapsed sidebar by default
                    sidebar.classList.remove('active');
                } else {
                    // Desktop view - expanded sidebar
                    sidebar.classList.remove('active');
                }
            }

            // Initialize on page load
            handleResponsiveLayout();

            // Update on window resize
            let resizeTimer;
            window.addEventListener('resize', function() {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(handleResponsiveLayout, 250);
            });

            // Update username from Firebase
            updateSidebarUsername();

            // Logout link
            const sidebarLogoutLink = document.getElementById('sidebar-logout-link');
            if (sidebarLogoutLink) {
                sidebarLogoutLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    if (confirm('Are you sure you want to logout?')) {
                        if (window.FirebaseAuth && window.FirebaseAuth.logout) {
                            window.FirebaseAuth.logout();
                        }
                        window.location.href = 'login.html';
                    }
                });
            }
        });
    </script>
</body>
</html>
